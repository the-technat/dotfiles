#!/usr/bin/env zsh

if command -v "chsh" > /dev/null; then
  shell=$(getent passwd {{ .chezmoi.username }} | awk -F : '{print $NF}')
  if [ ${shell} != *"zsh"* ]; then
    echo "shell change is required"
    if command -v "sudo" > /dev/null; then
      echo "changing shell can be done using sudo (password-less)"
      sudo -u root chsh -s $(command -v zsh) {{ .chezmoi.username }}
    else
      echo "changing shell requires your password"
      {{ if .tty -}}
      chsh -s $(command -v zsh) {{ .chezmoi.username }}
      {{ end -}}
    fi
  fi
else
  echo "shell must be changed manually, no chsh binary found"
fi
